---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
```{r Loading packages}
packages = c('tidyverse')

for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}
```

```{r Reading each policy csv}
filenames <- list.files(path = "C:/Users/user/Documents/GitHub/Covid-19-Singapore-Analysis/Analysis/General EDA/merged_eda_datasets", pattern = "*.csv", full.names = TRUE)

filelist <- lapply(filenames, read.csv)

names(filelist) <- c("circuit_breaker_df", "economic_measures_df", "foreign_workers_df", "masks_df", "phases_df", "safeentry_df", "social_distancing_df", "shn_df","tracetogether_df", "vaccination_df")

lapply(names(filelist), function(x) assign(x,filelist[[x]],envir=.GlobalEnv))

```

```{r Creating dataframe}
Number_of_comments <- c(nrow(circuit_breaker_df), nrow(economic_measures_df), nrow(foreign_workers_df), nrow(masks_df), nrow(phases_df), nrow(safeentry_df), nrow(social_distancing_df), nrow(shn_df), nrow(tracetogether_df), nrow(vaccination_df))
Policy <- c("Circuit Breaker", "Economic measures", "Foreign workers", "Masks", "Phases", "SafeEntry", "Social distancing", "SHN", "TraceTogether", "Vaccination")

df <- data.frame(Policy, Number_of_comments)
df
```
```{r}
total_num <- ggplot(df, aes(x=Policy, y=Number_of_comments, fill=Policy)) +
  geom_col() +
  geom_text(aes(label=Number_of_comments), vjust = -0.5) +
  ggtitle("Total Number of comments collected across social media for each policy") +
  theme(axis.text.x = element_text(angle = 30,hjust=1))

total_num
```

```{r}
all <- read_csv("C:/Users/user/Documents/GitHub/Covid-19-Singapore-Analysis/Analysis/General EDA/raw_combined.csv")

df <- data.frame(all)
df <- subset(df, select = -c(Comments))
df$count <- rep(1, nrow(df))
df

platform_totals <- df %>% 
  group_by(platform) %>%
  summarise(total=sum(count))
platform_totals

all_grouped <- df %>% 
  group_by(platform, policy) %>%
  summarise(policy_count=sum(count))
all_grouped

combined <- inner_join(platform_totals, all_grouped, by=c("platform" = "platform")) %>%
  mutate(Proportion = policy_count/total *100)
combined
```

```{r Proportion of Policy Comments for each Social Media Platform}
total_proportion <- ggplot(combined, aes(x=platform, y=Proportion, fill=policy)) + 
  geom_col(colour="black", position="fill") +
  scale_y_continuous(labels = scales::percent)

total_proportion
```
```{r}
valuable <- read_csv("C:/Users/user/Documents/GitHub/Covid-19-Singapore-Analysis/Analysis/General EDA/valuable_combined.csv")
valuable

valuable_df <- data.frame(valuable)
valuable_df <- subset(valuable_df, select = -c(Comments))
valuable_df$count <- rep(1, nrow(valuable_df))
valuable_df

valuable_policy <- valuable_df %>%
  group_by(policy) %>%
  summarise(Number_of_comments=sum(count))

valuable_num <- ggplot(valuable_policy, aes(x=Policy, y=Number_of_comments, fill=Policy)) +
  geom_col() +
  geom_text(aes(label=Number_of_comments), vjust = -0.5) +
  ggtitle("Total Number of comments collected across social media for each policy") +
  theme(axis.text.x = element_text(angle = 30,hjust=1))

valuable_num
```

```{r}
valuable_platform_totals <- valuable_df %>% 
  group_by(platform) %>%
  summarise(total=sum(count))
valuable_platform_totals

valuable_all_grouped <- valuable_df %>% 
  group_by(platform, policy) %>%
  summarise(policy_count=sum(count))
valuable_all_grouped

valuable_combined <- inner_join(valuable_platform_totals, valuable_all_grouped, by=c("platform" = "platform")) %>%
  mutate(Proportion = policy_count/total *100)
valuable_combined
```
```{r Proportion of Valuable Policy Comments for each Social Media Platform}
valuable_proportion <- ggplot(valuable_combined, aes(x=platform, y=Proportion, fill=policy)) + 
  geom_col(colour="black", position="fill") +
  scale_y_continuous(labels = scales::percent)

valuable_proportion
```
```{r}
library(ggpubr)
num_combined <- ggarrange(total_num, valuable_num, 
          ncol=1, nrow=2,
          common.legend = TRUE, legend = "right")
num_combined


proportion_combined <- ggarrange(total_proportion, valuable_proportion, 
          ncol=1, nrow=2,
          common.legend = TRUE, legend = "right")
proportion_combined
```

```{r}
library(ggpubr)
combined <- ggarrange(total_proportion, valuable_proportion, 
          ncol=1, nrow=2,
          labels = c("Total Comments", "Valuable Comments"),
          common.legend = TRUE, legend = "right")

annotate_figure(combined,
                fig.lab = "Proportion of Policy Comments for each Social Media Platform", fig.lab.face = "bold")
```

```{r}
library(reshape)
library(tm)
library(wordcloud)
```

